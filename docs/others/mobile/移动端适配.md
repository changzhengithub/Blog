# 移动端适配

## 基本概念

**物理像素(DP)**

物理像素又称设备像素/设备物理像素，是组成屏幕的一个个真实的物理像素点，比如屏幕的分辨率是 750 * 1334 ，说明这个屏幕就是由真实的 750 * 1334 个像素点组成，从出厂那一刻就不会改变了。

**CSS像素**

CSS像素是一个相对单位，它并不是完全等于物理像素，只是表示一个最小基本单位的抽象概念。

一般默认情况下一个CSS像素等于一个物理像素，在多倍屏下会相当于多个物理像素。

**设备独立像素(DIP)**

设备独立像素和CSS像素一样，表示一个最小的基本单位，也被称为逻辑像素。一个抽象的独立像素代表多少物理像素。

设备独立像素 = CSS 像素 = 逻辑像素

**设备像素比(DPR)**

设备像素比描述的是未缩放状态下，物理像素和设备独立像素的初始比例关系。表示一个设备独立像素或者一个CSS像素可以容纳多少个物理像素。

DPR = 物理像素 / 设备独立像素(CSS像素)

在不同的屏幕上，CSS像素所呈现的物理尺寸是一致的，而不同的是CSS像素所对应的物理像素具数是不一致的。在普通屏幕下1个CSS像素对应1个物理像素，而在Retina视网膜屏幕下，1个CSS像素对应的却是4个物理像素。

获取DPR：window.devicePixelRatio 或者媒体查询 min-device-pixel-ratio
```js
window.devicePixelRatio
```
```css
@media only screen and (-webkit-min-device-pixel-ratio:2){}
```

## 视口

```html
<meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1; minimum-scale=1; user-scalable=no;">
```

## 适配

**使用lib-flexible**

1、引入flexible

在head头部引入lib-flexible.js，不要设置meta视口，执行这个js后，会在html上增加一个data-dpr属性，以及设置font-size大小。之后页面中的元素，都可以用rem单位来设置。html上的font-size就是rem的基准像素。

2、把视觉稿中的px转换成rem

以设计稿750为例，把视觉稿分成100份来看待。每一份被称为一个单位a。同时，1rem单位认定为10a。1rem为设计稿的1/10。
```sh
1a = 7.5px
1rem = 75px
```
因此，对于视觉稿上的元素的尺寸换算，只需要原始px值除以rem基准px值即可。例如240px * 120px的元素，最后转换为3.2rem * 1.6rem。

3、字体不使用rem的方法

字体的大小不推荐用rem作为单位。所以对于字体的设置，仍旧使用px作为单位，并配合用data-dpr属性来区分不同dpr下的的大小。
```css
div {
  width: 1rem; 
  height: 0.4rem;
  font-size: 12px; // 默认写上dpr为1的fontSize
}

[data-dpr="2"] div {
  font-size: 24px;
}

[data-dpr="3"] div {
  font-size: 36px;
}
```

使用less或者sass 动态显示字体大小
```css
// 适配dpr的字体大小
@mixin font-dpr($font-size){
  font-size: $font-size;

  [data-dpr="2"] & {
      font-size: $font-size * 2;
  }

  [data-dpr="3"] & {
      font-size: $font-size * 3;
  }
}

/* 使用 */
@include font-dpr(14px);
```




参考链接：

[使用Flexible实现手淘H5页面的终端适配](https://github.com/amfe/article/issues/17)

[关于移动端适配](https://juejin.cn/post/6844903845617729549)

[移动端开发的屏幕、图像、字体与布局的兼容适配](https://cloud.tencent.com/developer/article/1499916)

[CSS像素、物理像素、逻辑像素、设备像素比、PPI、Viewport](https://github.com/jawil/blog/issues/21)